/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path="../Lib/jquery/typings.d.ts" />
///<reference path="../Lib/jsplumb/typings.d.ts" />
///<reference path="./workflow-models.ts" />
var WorkflowEditor = /** @class */ (function () {
    function WorkflowEditor(container, workflowDefinitionData) {
        var _this = this;
        this.container = container;
        this.serialize = function () {
            var allActivityElements = $(this.container).find(".activity");
            var workflow = {
                activities: [],
                transitions: []
            };
            // Collect activity positions.
            for (var i = 0; i < allActivityElements.length; i++) {
                var activityElementQuery = $(allActivityElements[i]);
                var activityId = activityElementQuery.data("activity-id");
                var activityPosition = activityElementQuery.position();
                workflow.activities.push({
                    id: activityId,
                    x: activityPosition.left,
                    y: activityPosition.top
                });
            }
            // Collect activity connections.
            var allConnections = this.jsPlumbInstance.getConnections();
            for (var i = 0; i < allConnections.length; i++) {
                var connection = allConnections[i];
                var sourceEndpoint = connection.endpoints[0];
                var sourceOutcomeName = sourceEndpoint.getParameters().outcome.name;
                var sourceActivityId = $(connection.source).data("activity-id");
                var destinationActivityId = $(connection.target).data("activity-id");
                workflow.transitions.push({
                    sourceActivityId: sourceActivityId,
                    destinationActivityId: destinationActivityId,
                    sourceOutcomeName: sourceOutcomeName
                });
            }
            return JSON.stringify(workflow);
        };
        jsPlumb.ready(function () {
            var plumber = jsPlumb.getInstance({
                DragOptions: { cursor: 'pointer', zIndex: 2000 },
                ConnectionOverlays: [
                    ["Arrow", {
                            location: 1,
                            visible: true,
                            width: 11,
                            length: 11
                        }],
                    ["Label", {
                            location: 0.5,
                            id: "label",
                            cssClass: "connection-label"
                        }]
                ],
                Container: container
            });
            var getSourceEndpointOptions = function (activity, outcome) {
                // The definition of source endpoints.
                return {
                    endpoint: "Dot",
                    anchor: "Continuous",
                    paintStyle: {
                        stroke: "#7AB02C",
                        fill: "#7AB02C",
                        radius: 7,
                        strokeWidth: 1
                    },
                    isSource: true,
                    connector: ["Flowchart", { stub: [40, 60], gap: 0, cornerRadius: 5, alwaysRespectStubs: true }],
                    connectorStyle: {
                        strokeWidth: 2,
                        stroke: "#999999",
                        joinstyle: "round",
                        outlineStroke: "white",
                        outlineWidth: 2
                    },
                    hoverPaintStyle: {
                        fill: "#216477",
                        stroke: "#216477"
                    },
                    connectorHoverStyle: {
                        strokeWidth: 3,
                        stroke: "#216477",
                        outlineWidth: 5,
                        outlineStroke: "white"
                    },
                    dragOptions: {},
                    overlays: [
                        ["Label", {
                                location: [0.5, 1.5],
                                //label: outcome.displayName,
                                cssClass: "endpointSourceLabel",
                                visible: true
                            }]
                    ],
                    uuid: activity.id + "-" + outcome.name,
                    parameters: {
                        outcome: outcome
                    }
                };
            };
            // Listen for new connections.
            plumber.bind("connection", function (connInfo, originalEvent) {
                var connection = connInfo.connection;
                var outcome = connection.getParameters().outcome;
                var label = connection.getOverlay("label");
                label.setLabel(outcome.displayName);
            });
            // Suspend drawing and initialize.
            plumber.batch(function () {
                var workflowModel = workflowDefinitionData;
                var workflowId = workflowModel.id;
                $(container).find(".activity").each(function (index, activityElement) {
                    var activityElementQuery = $(activityElement);
                    var activityId = activityElementQuery.data("activity-id");
                    // Make the activity draggable.
                    plumber.draggable(activityElement, { grid: [10, 10] });
                    // Configure the activity as a target.
                    plumber.makeTarget(activityElement, {
                        dropOptions: { hoverClass: "hover" },
                        anchor: "Continuous",
                        endpoint: ["Blank", { radius: 8 }]
                    });
                    // Add source endpoints.
                    var activity = $.grep(workflowModel.activities, function (x) { return x.id == activityId; })[0];
                    var hasMultipleOutcomes = activity.outcomes.length > 1;
                    for (var _i = 0, _a = activity.outcomes; _i < _a.length; _i++) {
                        var outcome = _a[_i];
                        var sourceEndpointOptions = getSourceEndpointOptions(activity, outcome);
                        plumber.addEndpoint(activityElement, sourceEndpointOptions);
                    }
                });
                // Connect activities.
                for (var _i = 0, _a = workflowModel.transitions; _i < _a.length; _i++) {
                    var transitionModel = _a[_i];
                    var sourceEndpointUuid = transitionModel.sourceActivityId + "-" + transitionModel.sourceOutcomeName;
                    var sourceEndpoint = plumber.getEndpoint(sourceEndpointUuid);
                    var destinationElementId = "activity-" + workflowId + "-" + transitionModel.destinationActivityId;
                    plumber.connect({
                        source: sourceEndpoint,
                        target: destinationElementId
                    });
                }
                plumber.bind("click", function (conn, originalEvent) {
                    //plumber.deleteConnection(conn);
                });
                plumber.bind("connectionDrag", function (connection) {
                    console.log("connection " + connection.id + " is being dragged. suspendedElement is ", connection.suspendedElement, " of type ", connection.suspendedElementType);
                });
                plumber.bind("connectionDragStop", function (connection) {
                    console.log("connection " + connection.id + " was dragged");
                });
                plumber.bind("connectionMoved", function (params) {
                    console.log("connection " + params.connection.id + " was moved");
                });
            });
            _this.jsPlumbInstance = plumber;
        });
    }
    return WorkflowEditor;
}());
$.fn.workflowEditor = function () {
    this.each(function (index, element) {
        var $element = $(element);
        var workflowDefinitionData = $element.data("workflow-definition");
        $element.data("workflowEditor", new WorkflowEditor(element, workflowDefinitionData));
    });
    return this;
};
$(document).ready(function () {
    var workflowEditor = $(".workflow-editor-canvas").workflowEditor().data("workflowEditor");
    $("#workflowEditorForm").on("submit", function (s, e) {
        var state = workflowEditor.serialize();
        $("#workflowStateInput").val(state);
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFDLEVBQUUsQ0FBQyxjQUFjLEdBQUc7SUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQUssRUFBRSxPQUFPO1FBQ3JCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxQixJQUFJLHNCQUFzQixHQUF1QixRQUFRLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFFdEYsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLGNBQWMsQ0FBQyxPQUFPLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO0lBQ3pGLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNoQixDQUFDLENBQUM7QUFFRixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQ2QsSUFBTSxjQUFjLEdBQW1CLENBQUMsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBRTVHLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQyxDQUFDLEVBQUUsQ0FBQztRQUN2QyxJQUFNLEtBQUssR0FBRyxjQUFjLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDekMsQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3hDLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoib3JjaGFyZC53b3JrZmxvd3Mtd29ya2Zsb3ctZWRpdG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vTGliL2pxdWVyeS90eXBpbmdzLmQudHNcIiAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9MaWIvanNwbHVtYi90eXBpbmdzLmQudHNcIiAvPlxyXG4vLy88cmVmZXJlbmNlIHBhdGg9XCIuL3dvcmtmbG93LW1vZGVscy50c1wiIC8+XHJcblxyXG5jbGFzcyBXb3JrZmxvd0VkaXRvciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHdvcmtmbG93RGVmaW5pdGlvbkRhdGE6IFdvcmtmbG93cy5Xb3JrZmxvdykge1xyXG5cclxuICAgICAgICBqc1BsdW1iLnJlYWR5KCgpID0+IHtcclxuICAgICAgICAgICAgdmFyIHBsdW1iZXIgPSBqc1BsdW1iLmdldEluc3RhbmNlKHtcclxuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxyXG4gICAgICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwibGFiZWxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6IFwiY29ubmVjdGlvbi1sYWJlbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBDb250YWluZXI6IGNvbnRhaW5lclxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBmdW5jdGlvbiAoYWN0aXZpdHk6IFdvcmtmbG93cy5BY3Rpdml0eSwgb3V0Y29tZTogV29ya2Zsb3dzLk91dGNvbWUpOiBFbmRwb2ludE9wdGlvbnMge1xyXG4gICAgICAgICAgICAgICAgLy8gVGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cy5cclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFwiRG90XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcclxuICAgICAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZTogXCIjN0FCMDJDXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IFwiIzdBQjAyQ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3I6IFtcIkZsb3djaGFydFwiLCB7IHN0dWI6IFs0MCwgNjBdLCBnYXA6IDAsIGNvcm5lclJhZGl1czogNSwgYWx3YXlzUmVzcGVjdFN0dWJzOiB0cnVlIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3RvclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2U6IFwiIzk5OTk5OVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBqb2luc3R5bGU6IFwicm91bmRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogXCJ3aGl0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsOiBcIiMyMTY0NzdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcIiMyMTY0NzdcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdG9ySG92ZXJTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXaWR0aDogMyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcIiMyMTY0NzdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiBcIndoaXRlXCJcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGRyYWdPcHRpb25zOiB7fSxcclxuICAgICAgICAgICAgICAgICAgICBvdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJMYWJlbFwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogWzAuNSwgMS41XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vbGFiZWw6IG91dGNvbWUuZGlzcGxheU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjc3NDbGFzczogXCJlbmRwb2ludFNvdXJjZUxhYmVsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgICAgICB1dWlkOiBgJHthY3Rpdml0eS5pZH0tJHtvdXRjb21lLm5hbWV9YCxcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dGNvbWU6IG91dGNvbWVcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gTGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnMuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmluZChcImNvbm5lY3Rpb25cIiwgZnVuY3Rpb24gKGNvbm5JbmZvLCBvcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uOiBDb25uZWN0aW9uID0gY29ubkluZm8uY29ubmVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG91dGNvbWU6IFdvcmtmbG93cy5PdXRjb21lID0gY29ubmVjdGlvbi5nZXRQYXJhbWV0ZXJzKCkub3V0Y29tZTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBsYWJlbDogYW55ID0gY29ubmVjdGlvbi5nZXRPdmVybGF5KFwibGFiZWxcIik7XHJcbiAgICAgICAgICAgICAgICBsYWJlbC5zZXRMYWJlbChvdXRjb21lLmRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBTdXNwZW5kIGRyYXdpbmcgYW5kIGluaXRpYWxpemUuXHJcbiAgICAgICAgICAgIHBsdW1iZXIuYmF0Y2goZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdvcmtmbG93TW9kZWw6IFdvcmtmbG93cy5Xb3JrZmxvdyA9IHdvcmtmbG93RGVmaW5pdGlvbkRhdGE7XHJcbiAgICAgICAgICAgICAgICB2YXIgd29ya2Zsb3dJZCA9IHdvcmtmbG93TW9kZWwuaWQ7XHJcblxyXG4gICAgICAgICAgICAgICAgJChjb250YWluZXIpLmZpbmQoXCIuYWN0aXZpdHlcIikuZWFjaCgoaW5kZXgsIGFjdGl2aXR5RWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5RWxlbWVudFF1ZXJ5ID0gJChhY3Rpdml0eUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSBhY3Rpdml0eUVsZW1lbnRRdWVyeS5kYXRhKFwiYWN0aXZpdHktaWRcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGFjdGl2aXR5IGRyYWdnYWJsZS5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmRyYWdnYWJsZShhY3Rpdml0eUVsZW1lbnQsIHsgZ3JpZDogWzEwLCAxMF0gfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIENvbmZpZ3VyZSB0aGUgYWN0aXZpdHkgYXMgYSB0YXJnZXQuXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5tYWtlVGFyZ2V0KGFjdGl2aXR5RWxlbWVudCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkcm9wT3B0aW9uczogeyBob3ZlckNsYXNzOiBcImhvdmVyXCIgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBcIkNvbnRpbnVvdXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFtcIkJsYW5rXCIsIHsgcmFkaXVzOiA4IH1dXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIEFkZCBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFjdGl2aXR5ID0gJC5ncmVwKHdvcmtmbG93TW9kZWwuYWN0aXZpdGllcywgKHg6IFdvcmtmbG93cy5BY3Rpdml0eSkgPT4geC5pZCA9PSBhY3Rpdml0eUlkKVswXTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBoYXNNdWx0aXBsZU91dGNvbWVzID0gYWN0aXZpdHkub3V0Y29tZXMubGVuZ3RoID4gMTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb3V0Y29tZSBvZiBhY3Rpdml0eS5vdXRjb21lcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoYWN0aXZpdHksIG91dGNvbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLmFkZEVuZHBvaW50KGFjdGl2aXR5RWxlbWVudCwgc291cmNlRW5kcG9pbnRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBDb25uZWN0IGFjdGl2aXRpZXMuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB0cmFuc2l0aW9uTW9kZWwgb2Ygd29ya2Zsb3dNb2RlbC50cmFuc2l0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUVuZHBvaW50VXVpZDogc3RyaW5nID0gYCR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZUFjdGl2aXR5SWR9LSR7dHJhbnNpdGlvbk1vZGVsLnNvdXJjZU91dGNvbWVOYW1lfWA7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gcGx1bWJlci5nZXRFbmRwb2ludChzb3VyY2VFbmRwb2ludFV1aWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uRWxlbWVudElkOiBzdHJpbmcgPSBgYWN0aXZpdHktJHt3b3JrZmxvd0lkfS0ke3RyYW5zaXRpb25Nb2RlbC5kZXN0aW5hdGlvbkFjdGl2aXR5SWR9YDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5jb25uZWN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBzb3VyY2VFbmRwb2ludCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0OiBkZXN0aW5hdGlvbkVsZW1lbnRJZFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHBsdW1iZXIuYmluZChcImNsaWNrXCIsIGZ1bmN0aW9uIChjb25uLCBvcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wbHVtYmVyLmRlbGV0ZUNvbm5lY3Rpb24oY29ubik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBwbHVtYmVyLmJpbmQoXCJjb25uZWN0aW9uRHJhZ1wiLCBmdW5jdGlvbiAoY29ubmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdGlvbiBcIiArIGNvbm5lY3Rpb24uaWQgKyBcIiBpcyBiZWluZyBkcmFnZ2VkLiBzdXNwZW5kZWRFbGVtZW50IGlzIFwiLCBjb25uZWN0aW9uLnN1c3BlbmRlZEVsZW1lbnQsIFwiIG9mIHR5cGUgXCIsIGNvbm5lY3Rpb24uc3VzcGVuZGVkRWxlbWVudFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGx1bWJlci5iaW5kKFwiY29ubmVjdGlvbkRyYWdTdG9wXCIsIGZ1bmN0aW9uIChjb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uIFwiICsgY29ubmVjdGlvbi5pZCArIFwiIHdhcyBkcmFnZ2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGx1bWJlci5iaW5kKFwiY29ubmVjdGlvbk1vdmVkXCIsIGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbm5lY3Rpb24gXCIgKyBwYXJhbXMuY29ubmVjdGlvbi5pZCArIFwiIHdhcyBtb3ZlZFwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuanNQbHVtYkluc3RhbmNlID0gcGx1bWJlcjtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGpzUGx1bWJJbnN0YW5jZToganNQbHVtYkluc3RhbmNlO1xyXG5cclxuICAgIHB1YmxpYyBzZXJpYWxpemUgPSBmdW5jdGlvbiAoKTogc3RyaW5nIHtcclxuICAgICAgICBjb25zdCBhbGxBY3Rpdml0eUVsZW1lbnRzID0gJCh0aGlzLmNvbnRhaW5lcikuZmluZChcIi5hY3Rpdml0eVwiKTtcclxuICAgICAgICBjb25zdCB3b3JrZmxvdzogYW55ID0ge1xyXG4gICAgICAgICAgICBhY3Rpdml0aWVzOiBbXSxcclxuICAgICAgICAgICAgdHJhbnNpdGlvbnM6IFtdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gQ29sbGVjdCBhY3Rpdml0eSBwb3NpdGlvbnMuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGxBY3Rpdml0eUVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eUVsZW1lbnRRdWVyeSA9ICQoYWxsQWN0aXZpdHlFbGVtZW50c1tpXSk7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eUlkOiBudW1iZXIgPSBhY3Rpdml0eUVsZW1lbnRRdWVyeS5kYXRhKFwiYWN0aXZpdHktaWRcIik7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpdml0eVBvc2l0aW9uID0gYWN0aXZpdHlFbGVtZW50UXVlcnkucG9zaXRpb24oKTtcclxuXHJcbiAgICAgICAgICAgIHdvcmtmbG93LmFjdGl2aXRpZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBpZDogYWN0aXZpdHlJZCxcclxuICAgICAgICAgICAgICAgIHg6IGFjdGl2aXR5UG9zaXRpb24ubGVmdCxcclxuICAgICAgICAgICAgICAgIHk6IGFjdGl2aXR5UG9zaXRpb24udG9wXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ29sbGVjdCBhY3Rpdml0eSBjb25uZWN0aW9ucy5cclxuICAgICAgICBjb25zdCBhbGxDb25uZWN0aW9ucyA9IHRoaXMuanNQbHVtYkluc3RhbmNlLmdldENvbm5lY3Rpb25zKCk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGxDb25uZWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgY29ubmVjdGlvbiA9IGFsbENvbm5lY3Rpb25zW2ldO1xyXG4gICAgICAgICAgICB2YXIgc291cmNlRW5kcG9pbnQ6IEVuZHBvaW50ID0gY29ubmVjdGlvbi5lbmRwb2ludHNbMF07XHJcbiAgICAgICAgICAgIHZhciBzb3VyY2VPdXRjb21lTmFtZSA9IHNvdXJjZUVuZHBvaW50LmdldFBhcmFtZXRlcnMoKS5vdXRjb21lLm5hbWU7XHJcbiAgICAgICAgICAgIHZhciBzb3VyY2VBY3Rpdml0eUlkOiBudW1iZXIgPSAkKGNvbm5lY3Rpb24uc291cmNlKS5kYXRhKFwiYWN0aXZpdHktaWRcIik7XHJcbiAgICAgICAgICAgIHZhciBkZXN0aW5hdGlvbkFjdGl2aXR5SWQ6IG51bWJlciA9ICQoY29ubmVjdGlvbi50YXJnZXQpLmRhdGEoXCJhY3Rpdml0eS1pZFwiKTtcclxuXHJcbiAgICAgICAgICAgIHdvcmtmbG93LnRyYW5zaXRpb25zLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgc291cmNlQWN0aXZpdHlJZDogc291cmNlQWN0aXZpdHlJZCxcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQWN0aXZpdHlJZDogZGVzdGluYXRpb25BY3Rpdml0eUlkLFxyXG4gICAgICAgICAgICAgICAgc291cmNlT3V0Y29tZU5hbWU6IHNvdXJjZU91dGNvbWVOYW1lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkod29ya2Zsb3cpO1xyXG4gICAgfVxyXG59XHJcblxyXG4kLmZuLndvcmtmbG93RWRpdG9yID0gZnVuY3Rpb24gKHRoaXM6IEpRdWVyeSk6IEpRdWVyeSB7XHJcbiAgICB0aGlzLmVhY2goKGluZGV4LCBlbGVtZW50KSA9PiB7XHJcbiAgICAgICAgdmFyICRlbGVtZW50ID0gJChlbGVtZW50KTtcclxuICAgICAgICB2YXIgd29ya2Zsb3dEZWZpbml0aW9uRGF0YTogV29ya2Zsb3dzLldvcmtmbG93ID0gJGVsZW1lbnQuZGF0YShcIndvcmtmbG93LWRlZmluaXRpb25cIik7XHJcblxyXG4gICAgICAgICRlbGVtZW50LmRhdGEoXCJ3b3JrZmxvd0VkaXRvclwiLCBuZXcgV29ya2Zsb3dFZGl0b3IoZWxlbWVudCwgd29ya2Zsb3dEZWZpbml0aW9uRGF0YSkpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCB3b3JrZmxvd0VkaXRvcjogV29ya2Zsb3dFZGl0b3IgPSAkKFwiLndvcmtmbG93LWVkaXRvci1jYW52YXNcIikud29ya2Zsb3dFZGl0b3IoKS5kYXRhKFwid29ya2Zsb3dFZGl0b3JcIik7XHJcblxyXG4gICAgJChcIiN3b3JrZmxvd0VkaXRvckZvcm1cIikub24oXCJzdWJtaXRcIiwgKHMsIGUpID0+IHtcclxuICAgICAgICBjb25zdCBzdGF0ZSA9IHdvcmtmbG93RWRpdG9yLnNlcmlhbGl6ZSgpO1xyXG4gICAgICAgICQoXCIjd29ya2Zsb3dTdGF0ZUlucHV0XCIpLnZhbChzdGF0ZSk7XHJcbiAgICB9KTtcclxufSk7Il19
