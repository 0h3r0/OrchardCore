/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path="../Lib/jquery/typings.d.ts" />
///<reference path="../Lib/jsplumb/typings.d.ts" />
///<reference path="./workflow-models.ts" />
var WorkflowEditor = /** @class */ (function () {
    function WorkflowEditor(container, workflowDefinitionData) {
        jsPlumb.ready(function () {
            var plumber = jsPlumb.getInstance({
                DragOptions: { cursor: 'pointer', zIndex: 2000 },
                ConnectionOverlays: [
                    ["Arrow", {
                            location: 1,
                            visible: true,
                            width: 11,
                            length: 11
                        }],
                    ["Label", {
                            location: 0.5,
                            id: "label",
                            cssClass: "connection-label"
                        }]
                ],
                Container: container
            });
            var getSourceEndpointOptions = function (overlayLabel) {
                // The definition of source endpoints.
                return {
                    endpoint: "Dot",
                    anchor: "Continuous",
                    paintStyle: {
                        stroke: "#7AB02C",
                        fill: "#7AB02C",
                        radius: 7,
                        strokeWidth: 1
                    },
                    isSource: true,
                    connector: ["Flowchart", { stub: [40, 60], gap: 0, cornerRadius: 5, alwaysRespectStubs: true }],
                    connectorStyle: {
                        strokeWidth: 2,
                        stroke: "#999999",
                        joinstyle: "round",
                        outlineStroke: "white",
                        outlineWidth: 2
                    },
                    hoverPaintStyle: {
                        fill: "#216477",
                        stroke: "#216477"
                    },
                    connectorHoverStyle: {
                        strokeWidth: 3,
                        stroke: "#216477",
                        outlineWidth: 5,
                        outlineStroke: "white"
                    },
                    dragOptions: {},
                    overlays: [
                        ["Label", {
                                location: [0.5, 1.5],
                                label: overlayLabel,
                                cssClass: "endpointSourceLabel",
                                visible: overlayLabel != null
                            }]
                    ]
                };
            };
            var init = function (connection) {
                connection.getOverlay("label").setLabel(connection.sourceId.substring(15) + "-" + connection.targetId.substring(15));
            };
            // Suspend drawing and initialize.
            plumber.batch(function () {
                // Listen for new connections; initialise them the same way we initialise the connections at startup.
                plumber.bind("connection", function (connInfo, originalEvent) {
                    init(connInfo.connection);
                });
                // Initialize activities, endpoints and connectors from model.
                var test = workflowDefinitionData;
                var workflowModel = {
                    activities: [{
                            id: 1,
                            left: 50,
                            top: 50,
                            outcomes: [{
                                    name: "Done",
                                    displayName: "Gereed"
                                }]
                        }, {
                            id: 2,
                            left: 500,
                            top: 150,
                            outcomes: [{
                                    name: "True",
                                    displayName: "True"
                                }, {
                                    name: "False",
                                    displayName: "False"
                                }]
                        }, {
                            id: 3,
                            left: 50,
                            top: 250,
                            outcomes: [{
                                    name: "Done",
                                    displayName: "Done"
                                }]
                        }, {
                            id: 4,
                            left: 350,
                            top: 250,
                            outcomes: [{
                                    name: "Done",
                                    displayName: "Done"
                                }]
                        }
                    ],
                    connections: [{
                            outcomeName: "Done",
                            sourceId: 1,
                            targetId: 2
                        }, {
                            outcomeName: "True",
                            sourceId: 2,
                            targetId: 3
                        }, {
                            outcomeName: "False",
                            sourceId: 2,
                            targetId: 4
                        }
                    ]
                };
                for (var _i = 0, _a = workflowModel.activities; _i < _a.length; _i++) {
                    var activityModel = _a[_i];
                    // Generate activity HTML element.
                    var activityNode = $("<div class=\"activity\" style=\"left:" + activityModel.left + "px; top:" + activityModel.top + "px;\"></div>");
                    var activityElement = activityNode[0];
                    // Add activity HTML element to the canvas.
                    $(container).append(activityNode);
                    // Make the activity draggable.
                    plumber.draggable(activityElement, { grid: [20, 20] });
                    // Configure the activity as a target.
                    plumber.makeTarget(activityElement, {
                        dropOptions: { hoverClass: "hover" },
                        anchor: "Continuous",
                        endpoint: ["Blank", { radius: 8 }]
                    });
                    // Add source endpoints.
                    var hasMultipleOutcomes = activityModel.outcomes.length > 1;
                    for (var _b = 0, _c = activityModel.outcomes; _b < _c.length; _b++) {
                        var outcome = _c[_b];
                        var sourceEndpointOptions = getSourceEndpointOptions(hasMultipleOutcomes ? outcome.displayName : null);
                        plumber.addEndpoint(activityElement, sourceEndpointOptions);
                    }
                }
                plumber.bind("click", function (conn, originalEvent) {
                    plumber.deleteConnection(conn);
                });
                plumber.bind("connectionDrag", function (connection) {
                    console.log("connection " + connection.id + " is being dragged. suspendedElement is ", connection.suspendedElement, " of type ", connection.suspendedElementType);
                });
                plumber.bind("connectionDragStop", function (connection) {
                    console.log("connection " + connection.id + " was dragged");
                });
                plumber.bind("connectionMoved", function (params) {
                    console.log("connection " + params.connection.id + " was moved");
                });
            });
            this.jsPlumbInstance = plumber;
        });
    }
    return WorkflowEditor;
}());
$.fn.workflowEditor = function () {
    this.each(function (index, element) {
        var $element = $(element);
        var workflowDefinitionData = $element.data("workflow-definition");
        debugger;
        $element.data("workflowEditor", new WorkflowEditor(element, workflowDefinitionData));
    });
    return this;
};
$(document).ready(function () {
    $('.workflow-editor-canvas').workflowEditor();
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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UCxDQUFDO0lBR0wscUJBQUM7QUFBRCxDQW5MQSxBQW1MQyxJQUFBO0FBRUQsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxjQUFjLEdBQUc7SUFDbEIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQUssRUFBRSxPQUFPO1FBQ3JCLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxQixJQUFJLHNCQUFzQixHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNsRSxRQUFRLENBQUM7UUFDVCxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksY0FBYyxDQUFDLE9BQU8sRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7SUFDekYsQ0FBQyxDQUFDLENBQUM7SUFFSCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2hCLENBQUMsQ0FBQztBQUVGLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDZCxDQUFDLENBQUMseUJBQXlCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJvcmNoYXJkLndvcmtmbG93cy13b3JrZmxvdy1lZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50c1wiIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50c1wiIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4vd29ya2Zsb3ctbW9kZWxzLnRzXCIgLz5cclxuXHJcbmNsYXNzIFdvcmtmbG93RWRpdG9yIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIHdvcmtmbG93RGVmaW5pdGlvbkRhdGE6IFdvcmtmbG93cy5Xb3JrZmxvdykge1xyXG4gICAgICAgIGpzUGx1bWIucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcGx1bWJlciA9IGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xyXG5cclxuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxyXG4gICAgICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuNSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwibGFiZWxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6IFwiY29ubmVjdGlvbi1sYWJlbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBDb250YWluZXI6IGNvbnRhaW5lclxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBmdW5jdGlvbiAob3ZlcmxheUxhYmVsOiBzdHJpbmcpOiBFbmRwb2ludCB7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGUgZGVmaW5pdGlvbiBvZiBzb3VyY2UgZW5kcG9pbnRzLlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogXCJEb3RcIixcclxuICAgICAgICAgICAgICAgICAgICBhbmNob3I6IFwiQ29udGludW91c1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhaW50U3R5bGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcIiM3QUIwMkNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogXCIjN0FCMDJDXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhZGl1czogNyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDFcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGlzU291cmNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbm5lY3RvcjogW1wiRmxvd2NoYXJ0XCIsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMCwgY29ybmVyUmFkaXVzOiA1LCBhbHdheXNSZXNwZWN0U3R1YnM6IHRydWUgfV0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZTogXCIjOTk5OTk5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogXCJyb3VuZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lU3Ryb2tlOiBcIndoaXRlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmVXaWR0aDogMlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaG92ZXJQYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw6IFwiIzIxNjQ3N1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2U6IFwiIzIxNjQ3N1wiXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjb25uZWN0b3JIb3ZlclN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2U6IFwiIzIxNjQ3N1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRsaW5lV2lkdGg6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dGxpbmVTdHJva2U6IFwid2hpdGVcIlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZHJhZ09wdGlvbnM6IHt9LFxyXG4gICAgICAgICAgICAgICAgICAgIG92ZXJsYXlzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBbMC41LCAxLjVdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IG92ZXJsYXlMYWJlbCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNzc0NsYXNzOiBcImVuZHBvaW50U291cmNlTGFiZWxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IG92ZXJsYXlMYWJlbCAhPSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKGNvbm5lY3Rpb246IENvbm5lY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uZ2V0T3ZlcmxheShcImxhYmVsXCIpLnNldExhYmVsKGNvbm5lY3Rpb24uc291cmNlSWQuc3Vic3RyaW5nKDE1KSArIFwiLVwiICsgY29ubmVjdGlvbi50YXJnZXRJZC5zdWJzdHJpbmcoMTUpKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIC8vIFN1c3BlbmQgZHJhd2luZyBhbmQgaW5pdGlhbGl6ZS5cclxuICAgICAgICAgICAgcGx1bWJlci5iYXRjaChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIG5ldyBjb25uZWN0aW9uczsgaW5pdGlhbGlzZSB0aGVtIHRoZSBzYW1lIHdheSB3ZSBpbml0aWFsaXNlIHRoZSBjb25uZWN0aW9ucyBhdCBzdGFydHVwLlxyXG4gICAgICAgICAgICAgICAgcGx1bWJlci5iaW5kKFwiY29ubmVjdGlvblwiLCBmdW5jdGlvbiAoY29ubkluZm8sIG9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbml0KGNvbm5JbmZvLmNvbm5lY3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBhY3Rpdml0aWVzLCBlbmRwb2ludHMgYW5kIGNvbm5lY3RvcnMgZnJvbSBtb2RlbC5cclxuICAgICAgICAgICAgICAgIHZhciB0ZXN0ID0gd29ya2Zsb3dEZWZpbml0aW9uRGF0YTtcclxuICAgICAgICAgICAgICAgIHZhciB3b3JrZmxvd01vZGVsOiBXb3JrZmxvd3MuV29ya2Zsb3cgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWN0aXZpdGllczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IDUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3A6IDUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRjb21lczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiRG9uZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiR2VyZWVkXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiA1MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMTUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRjb21lczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiVHJ1ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiVHJ1ZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiRmFsc2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOYW1lOiBcIkZhbHNlXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiA1MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiAyNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dGNvbWVzOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJEb25lXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogXCJEb25lXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgICAgICB9LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiA0LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZWZ0OiAzNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogMjUwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRjb21lczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IFwiRG9uZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWU6IFwiRG9uZVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dGNvbWVOYW1lOiBcIkRvbmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldElkOiAyXHJcbiAgICAgICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRjb21lTmFtZTogXCJUcnVlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZUlkOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogM1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0Y29tZU5hbWU6IFwiRmFsc2VcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlSWQ6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldElkOiA0XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYWN0aXZpdHlNb2RlbCBvZiB3b3JrZmxvd01vZGVsLmFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBhY3Rpdml0eSBIVE1MIGVsZW1lbnQuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2aXR5Tm9kZSA9ICQoYDxkaXYgY2xhc3M9XCJhY3Rpdml0eVwiIHN0eWxlPVwibGVmdDoke2FjdGl2aXR5TW9kZWwubGVmdH1weDsgdG9wOiR7YWN0aXZpdHlNb2RlbC50b3B9cHg7XCI+PC9kaXY+YCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGl2aXR5RWxlbWVudCA9IGFjdGl2aXR5Tm9kZVswXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGFjdGl2aXR5IEhUTUwgZWxlbWVudCB0byB0aGUgY2FudmFzLlxyXG4gICAgICAgICAgICAgICAgICAgICQoY29udGFpbmVyKS5hcHBlbmQoYWN0aXZpdHlOb2RlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFrZSB0aGUgYWN0aXZpdHkgZHJhZ2dhYmxlLlxyXG4gICAgICAgICAgICAgICAgICAgIHBsdW1iZXIuZHJhZ2dhYmxlKGFjdGl2aXR5RWxlbWVudCwgeyBncmlkOiBbMjAsIDIwXSB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyBhIHRhcmdldC5cclxuICAgICAgICAgICAgICAgICAgICBwbHVtYmVyLm1ha2VUYXJnZXQoYWN0aXZpdHlFbGVtZW50LCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6IFwiaG92ZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IFwiQ29udGludW91c1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRwb2ludDogW1wiQmxhbmtcIiwgeyByYWRpdXM6IDggfV1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHNvdXJjZSBlbmRwb2ludHMuXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGhhc011bHRpcGxlT3V0Y29tZXMgPSBhY3Rpdml0eU1vZGVsLm91dGNvbWVzLmxlbmd0aCA+IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgb3V0Y29tZSBvZiBhY3Rpdml0eU1vZGVsLm91dGNvbWVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBzb3VyY2VFbmRwb2ludE9wdGlvbnMgPSBnZXRTb3VyY2VFbmRwb2ludE9wdGlvbnMoaGFzTXVsdGlwbGVPdXRjb21lcyA/IG91dGNvbWUuZGlzcGxheU5hbWUgOiBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5hZGRFbmRwb2ludChhY3Rpdml0eUVsZW1lbnQsIHNvdXJjZUVuZHBvaW50T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHBsdW1iZXIuYmluZChcImNsaWNrXCIsIGZ1bmN0aW9uIChjb25uLCBvcmlnaW5hbEV2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGx1bWJlci5kZWxldGVDb25uZWN0aW9uKGNvbm4pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgcGx1bWJlci5iaW5kKFwiY29ubmVjdGlvbkRyYWdcIiwgZnVuY3Rpb24gKGNvbm5lY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvbm5lY3Rpb24gXCIgKyBjb25uZWN0aW9uLmlkICsgXCIgaXMgYmVpbmcgZHJhZ2dlZC4gc3VzcGVuZGVkRWxlbWVudCBpcyBcIiwgY29ubmVjdGlvbi5zdXNwZW5kZWRFbGVtZW50LCBcIiBvZiB0eXBlIFwiLCBjb25uZWN0aW9uLnN1c3BlbmRlZEVsZW1lbnRUeXBlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHBsdW1iZXIuYmluZChcImNvbm5lY3Rpb25EcmFnU3RvcFwiLCBmdW5jdGlvbiAoY29ubmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29ubmVjdGlvbiBcIiArIGNvbm5lY3Rpb24uaWQgKyBcIiB3YXMgZHJhZ2dlZFwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHBsdW1iZXIuYmluZChcImNvbm5lY3Rpb25Nb3ZlZFwiLCBmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uIFwiICsgcGFyYW1zLmNvbm5lY3Rpb24uaWQgKyBcIiB3YXMgbW92ZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmpzUGx1bWJJbnN0YW5jZSA9IHBsdW1iZXI7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBqc1BsdW1iSW5zdGFuY2U6IGpzUGx1bWJJbnN0YW5jZTtcclxufVxyXG5cclxuJC5mbi53b3JrZmxvd0VkaXRvciA9IGZ1bmN0aW9uICh0aGlzOiBKUXVlcnkpOiBKUXVlcnkge1xyXG4gICAgdGhpcy5lYWNoKChpbmRleCwgZWxlbWVudCkgPT4ge1xyXG4gICAgICAgIHZhciAkZWxlbWVudCA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgdmFyIHdvcmtmbG93RGVmaW5pdGlvbkRhdGEgPSAkZWxlbWVudC5kYXRhKFwid29ya2Zsb3ctZGVmaW5pdGlvblwiKTtcclxuICAgICAgICBkZWJ1Z2dlcjtcclxuICAgICAgICAkZWxlbWVudC5kYXRhKFwid29ya2Zsb3dFZGl0b3JcIiwgbmV3IFdvcmtmbG93RWRpdG9yKGVsZW1lbnQsIHdvcmtmbG93RGVmaW5pdGlvbkRhdGEpKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgJCgnLndvcmtmbG93LWVkaXRvci1jYW52YXMnKS53b3JrZmxvd0VkaXRvcigpO1xyXG59KTsiXX0=
