/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

///<reference path="../Lib/jquery/typings.d.ts" />
///<reference path="../Lib/jsplumb/typings.d.ts" />
var WorkflowEditor = /** @class */ (function () {
    function WorkflowEditor(container) {
        jsPlumb.ready(function () {
            var instance = jsPlumb.getInstance({
                DragOptions: { cursor: 'pointer', zIndex: 2000 },
                ConnectionOverlays: [
                    ["Arrow", {
                            location: 1,
                            visible: true,
                            width: 11,
                            length: 11
                        }],
                    ["Label", {
                            location: 0.1,
                            id: "label",
                            cssClass: "connection-label"
                        }]
                ],
                Container: container
            });
            var basicType = {
                connector: "StateMachine",
                paintStyle: { stroke: "red", strokeWidth: 4 },
                hoverPaintStyle: { stroke: "blue" },
                overlays: [
                    "Arrow"
                ]
            };
            instance.registerConnectionType("basic", basicType);
            // this is the paint style for the connecting lines..
            var connectorPaintStyle = {
                strokeWidth: 2,
                stroke: "#61B7CF",
                joinstyle: "round",
                outlineStroke: "white",
                outlineWidth: 2
            };
            // .. and this is the hover style.
            var connectorHoverStyle = {
                strokeWidth: 3,
                stroke: "#216477",
                outlineWidth: 5,
                outlineStroke: "white"
            };
            var endpointHoverStyle = {
                fill: "#216477",
                stroke: "#216477"
            };
            // the definition of source endpoints (the small blue ones)
            var sourceEndpoint = {
                endpoint: "Dot",
                paintStyle: {
                    stroke: "#7AB02C",
                    fill: "#7AB02C",
                    radius: 7,
                    strokeWidth: 1
                },
                isSource: true,
                connector: ["Flowchart", { stub: [40, 60], gap: 10, cornerRadius: 5, alwaysRespectStubs: true }],
                connectorStyle: connectorPaintStyle,
                hoverPaintStyle: endpointHoverStyle,
                connectorHoverStyle: connectorHoverStyle,
                dragOptions: {},
                overlays: [
                    ["Label", {
                            location: [0.5, 1.5],
                            label: "Drag",
                            cssClass: "endpointSourceLabel",
                            visible: false
                        }]
                ]
            };
            // the definition of target endpoints (will appear when the user drags a connection)
            var targetEndpoint = {
                endpoint: "Dot",
                paintStyle: { fill: "#7AB02C", radius: 7 },
                hoverPaintStyle: endpointHoverStyle,
                maxConnections: -1,
                dropOptions: { hoverClass: "hover", activeClass: "active" },
                isTarget: true,
                overlays: [
                    ["Label", { location: [0.5, -0.5], label: "Drop", cssClass: "endpointTargetLabel", visible: false }]
                ]
            };
            var init = function (connection) {
                connection.getOverlay("label").setLabel(connection.sourceId.substring(15) + "-" + connection.targetId.substring(15));
            };
            var addEndpoints = function (toId, sourceAnchors, targetAnchors) {
                for (var i = 0; i < sourceAnchors.length; i++) {
                    var sourceUUID = toId + sourceAnchors[i];
                    instance.addEndpoint("flowchart" + toId, sourceEndpoint, {
                        anchor: sourceAnchors[i], uuid: sourceUUID
                    });
                }
                //for (var j = 0; j < targetAnchors.length; j++) {
                //    var targetUUID = toId + targetAnchors[j];
                //    instance.addEndpoint("flowchart" + toId, targetEndpoint, { anchor: targetAnchors[j], uuid: targetUUID });
                //}
            };
            // suspend drawing and initialise.
            instance.batch(function () {
                addEndpoints("Window4", ["TopCenter", "BottomCenter"], ["LeftMiddle", "RightMiddle"]);
                addEndpoints("Window2", ["LeftMiddle", "BottomCenter"], ["TopCenter", "RightMiddle"]);
                addEndpoints("Window3", ["RightMiddle", "BottomCenter"], ["LeftMiddle", "TopCenter"]);
                addEndpoints("Window1", ["LeftMiddle", "RightMiddle"], ["TopCenter", "BottomCenter"]);
                // listen for new connections; initialise them the same way we initialise the connections at startup.
                instance.bind("connection", function (connInfo, originalEvent) {
                    init(connInfo.connection);
                });
                $(container).find(".activity").each(function () {
                    // Make the activity draggable.
                    instance.draggable(this, { grid: [20, 20] });
                    // Configure the activity as target.
                    instance.makeTarget(this, {
                        dropOptions: { hoverClass: "hover" },
                        anchor: "Top",
                        endpoint: ["Dot", { radius: 8 }]
                    });
                });
                // connect a few up
                instance.connect({ uuids: ["Window2BottomCenter", "Window3TopCenter"], editable: true });
                instance.connect({ uuids: ["Window2LeftMiddle", "Window4LeftMiddle"], editable: true });
                instance.connect({ uuids: ["Window4TopCenter", "Window4RightMiddle"], editable: true });
                instance.connect({ uuids: ["Window3RightMiddle", "Window2RightMiddle"], editable: true });
                instance.connect({ uuids: ["Window4BottomCenter", "Window1TopCenter"], editable: true });
                instance.connect({ uuids: ["Window3BottomCenter", "Window1BottomCenter"], editable: true });
                instance.bind("click", function (conn, originalEvent) {
                    instance.deleteConnection(conn);
                });
                instance.bind("connectionDrag", function (connection) {
                    console.log("connection " + connection.id + " is being dragged. suspendedElement is ", connection.suspendedElement, " of type ", connection.suspendedElementType);
                });
                instance.bind("connectionDragStop", function (connection) {
                    console.log("connection " + connection.id + " was dragged");
                });
                instance.bind("connectionMoved", function (params) {
                    console.log("connection " + params.connection.id + " was moved");
                });
            });
            this.jsPlumbInstance = instance;
        });
    }
    return WorkflowEditor;
}());
$.fn.workflowEditor = function () {
    var workflowEditor = new WorkflowEditor(this[0]);
    return this;
};
$(document).ready(function () {
    $('.workflow-editor-canvas').workflowEditor();
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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cmVmZXJlbmNlIHBhdGg9XCIuLi9MaWIvanF1ZXJ5L3R5cGluZ3MuZC50c1wiIC8+XHJcbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uL0xpYi9qc3BsdW1iL3R5cGluZ3MuZC50c1wiIC8+XHJcblxyXG5jbGFzcyBXb3JrZmxvd0VkaXRvciB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXI6IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAganNQbHVtYi5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IGpzUGx1bWIuZ2V0SW5zdGFuY2Uoe1xyXG5cclxuICAgICAgICAgICAgICAgIERyYWdPcHRpb25zOiB7IGN1cnNvcjogJ3BvaW50ZXInLCB6SW5kZXg6IDIwMDAgfSxcclxuICAgICAgICAgICAgICAgIENvbm5lY3Rpb25PdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFtcIkFycm93XCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoOiAxMVxyXG4gICAgICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IDAuMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwibGFiZWxcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6IFwiY29ubmVjdGlvbi1sYWJlbFwiXHJcbiAgICAgICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBDb250YWluZXI6IGNvbnRhaW5lclxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBiYXNpY1R5cGUgPSB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0b3I6IFwiU3RhdGVNYWNoaW5lXCIsXHJcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7IHN0cm9rZTogXCJyZWRcIiwgc3Ryb2tlV2lkdGg6IDQgfSxcclxuICAgICAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZTogeyBzdHJva2U6IFwiYmx1ZVwiIH0sXHJcbiAgICAgICAgICAgICAgICBvdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFwiQXJyb3dcIlxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaW5zdGFuY2UucmVnaXN0ZXJDb25uZWN0aW9uVHlwZShcImJhc2ljXCIsIGJhc2ljVHlwZSk7XHJcblxyXG4gICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBwYWludCBzdHlsZSBmb3IgdGhlIGNvbm5lY3RpbmcgbGluZXMuLlxyXG4gICAgICAgICAgICB2YXIgY29ubmVjdG9yUGFpbnRTdHlsZSA9IHtcclxuICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAyLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlOiBcIiM2MUI3Q0ZcIixcclxuICAgICAgICAgICAgICAgIGpvaW5zdHlsZTogXCJyb3VuZFwiLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogXCJ3aGl0ZVwiLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiAyXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyAuLiBhbmQgdGhpcyBpcyB0aGUgaG92ZXIgc3R5bGUuXHJcbiAgICAgICAgICAgIHZhciBjb25uZWN0b3JIb3ZlclN0eWxlID0ge1xyXG4gICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDMsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6IFwiIzIxNjQ3N1wiLFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVdpZHRoOiA1LFxyXG4gICAgICAgICAgICAgICAgb3V0bGluZVN0cm9rZTogXCJ3aGl0ZVwiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgZW5kcG9pbnRIb3ZlclN0eWxlID0ge1xyXG4gICAgICAgICAgICAgICAgZmlsbDogXCIjMjE2NDc3XCIsXHJcbiAgICAgICAgICAgICAgICBzdHJva2U6IFwiIzIxNjQ3N1wiXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gdGhlIGRlZmluaXRpb24gb2Ygc291cmNlIGVuZHBvaW50cyAodGhlIHNtYWxsIGJsdWUgb25lcylcclxuICAgICAgICAgICAgdmFyIHNvdXJjZUVuZHBvaW50ID0ge1xyXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFwiRG90XCIsXHJcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlOiBcIiM3QUIwMkNcIixcclxuICAgICAgICAgICAgICAgICAgICBmaWxsOiBcIiM3QUIwMkNcIixcclxuICAgICAgICAgICAgICAgICAgICByYWRpdXM6IDcsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg6IDFcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBpc1NvdXJjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNvbm5lY3RvcjogW1wiRmxvd2NoYXJ0XCIsIHsgc3R1YjogWzQwLCA2MF0sIGdhcDogMTAsIGNvcm5lclJhZGl1czogNSwgYWx3YXlzUmVzcGVjdFN0dWJzOiB0cnVlIH1dLFxyXG4gICAgICAgICAgICAgICAgY29ubmVjdG9yU3R5bGU6IGNvbm5lY3RvclBhaW50U3R5bGUsXHJcbiAgICAgICAgICAgICAgICBob3ZlclBhaW50U3R5bGU6IGVuZHBvaW50SG92ZXJTdHlsZSxcclxuICAgICAgICAgICAgICAgIGNvbm5lY3RvckhvdmVyU3R5bGU6IGNvbm5lY3RvckhvdmVyU3R5bGUsXHJcbiAgICAgICAgICAgICAgICBkcmFnT3B0aW9uczoge30sXHJcbiAgICAgICAgICAgICAgICBvdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IFswLjUsIDEuNV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiBcIkRyYWdcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3NzQ2xhc3M6IFwiZW5kcG9pbnRTb3VyY2VMYWJlbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1dXHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyB0aGUgZGVmaW5pdGlvbiBvZiB0YXJnZXQgZW5kcG9pbnRzICh3aWxsIGFwcGVhciB3aGVuIHRoZSB1c2VyIGRyYWdzIGEgY29ubmVjdGlvbilcclxuICAgICAgICAgICAgdmFyIHRhcmdldEVuZHBvaW50ID0ge1xyXG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6IFwiRG90XCIsXHJcbiAgICAgICAgICAgICAgICBwYWludFN0eWxlOiB7IGZpbGw6IFwiIzdBQjAyQ1wiLCByYWRpdXM6IDcgfSxcclxuICAgICAgICAgICAgICAgIGhvdmVyUGFpbnRTdHlsZTogZW5kcG9pbnRIb3ZlclN0eWxlLFxyXG4gICAgICAgICAgICAgICAgbWF4Q29ubmVjdGlvbnM6IC0xLFxyXG4gICAgICAgICAgICAgICAgZHJvcE9wdGlvbnM6IHsgaG92ZXJDbGFzczogXCJob3ZlclwiLCBhY3RpdmVDbGFzczogXCJhY3RpdmVcIiB9LFxyXG4gICAgICAgICAgICAgICAgaXNUYXJnZXQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBvdmVybGF5czogW1xyXG4gICAgICAgICAgICAgICAgICAgIFtcIkxhYmVsXCIsIHsgbG9jYXRpb246IFswLjUsIC0wLjVdLCBsYWJlbDogXCJEcm9wXCIsIGNzc0NsYXNzOiBcImVuZHBvaW50VGFyZ2V0TGFiZWxcIiwgdmlzaWJsZTogZmFsc2UgfV1cclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uIChjb25uZWN0aW9uOiBDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLmdldE92ZXJsYXkoXCJsYWJlbFwiKS5zZXRMYWJlbChjb25uZWN0aW9uLnNvdXJjZUlkLnN1YnN0cmluZygxNSkgKyBcIi1cIiArIGNvbm5lY3Rpb24udGFyZ2V0SWQuc3Vic3RyaW5nKDE1KSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgYWRkRW5kcG9pbnRzID0gZnVuY3Rpb24gKHRvSWQ6IHN0cmluZywgc291cmNlQW5jaG9yczogQXJyYXk8c3RyaW5nPiwgdGFyZ2V0QW5jaG9yczogQXJyYXk8c3RyaW5nPikge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2VBbmNob3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNvdXJjZVVVSUQ6IHN0cmluZyA9IHRvSWQgKyBzb3VyY2VBbmNob3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLmFkZEVuZHBvaW50KFwiZmxvd2NoYXJ0XCIgKyB0b0lkLCBzb3VyY2VFbmRwb2ludCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IHNvdXJjZUFuY2hvcnNbaV0sIHV1aWQ6IHNvdXJjZVVVSURcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vZm9yICh2YXIgaiA9IDA7IGogPCB0YXJnZXRBbmNob3JzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICB2YXIgdGFyZ2V0VVVJRCA9IHRvSWQgKyB0YXJnZXRBbmNob3JzW2pdO1xyXG4gICAgICAgICAgICAgICAgLy8gICAgaW5zdGFuY2UuYWRkRW5kcG9pbnQoXCJmbG93Y2hhcnRcIiArIHRvSWQsIHRhcmdldEVuZHBvaW50LCB7IGFuY2hvcjogdGFyZ2V0QW5jaG9yc1tqXSwgdXVpZDogdGFyZ2V0VVVJRCB9KTtcclxuICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy8gc3VzcGVuZCBkcmF3aW5nIGFuZCBpbml0aWFsaXNlLlxyXG4gICAgICAgICAgICBpbnN0YW5jZS5iYXRjaChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgYWRkRW5kcG9pbnRzKFwiV2luZG93NFwiLCBbXCJUb3BDZW50ZXJcIiwgXCJCb3R0b21DZW50ZXJcIl0sIFtcIkxlZnRNaWRkbGVcIiwgXCJSaWdodE1pZGRsZVwiXSk7XHJcbiAgICAgICAgICAgICAgICBhZGRFbmRwb2ludHMoXCJXaW5kb3cyXCIsIFtcIkxlZnRNaWRkbGVcIiwgXCJCb3R0b21DZW50ZXJcIl0sIFtcIlRvcENlbnRlclwiLCBcIlJpZ2h0TWlkZGxlXCJdKTtcclxuICAgICAgICAgICAgICAgIGFkZEVuZHBvaW50cyhcIldpbmRvdzNcIiwgW1wiUmlnaHRNaWRkbGVcIiwgXCJCb3R0b21DZW50ZXJcIl0sIFtcIkxlZnRNaWRkbGVcIiwgXCJUb3BDZW50ZXJcIl0pO1xyXG4gICAgICAgICAgICAgICAgYWRkRW5kcG9pbnRzKFwiV2luZG93MVwiLCBbXCJMZWZ0TWlkZGxlXCIsIFwiUmlnaHRNaWRkbGVcIl0sIFtcIlRvcENlbnRlclwiLCBcIkJvdHRvbUNlbnRlclwiXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gbGlzdGVuIGZvciBuZXcgY29ubmVjdGlvbnM7IGluaXRpYWxpc2UgdGhlbSB0aGUgc2FtZSB3YXkgd2UgaW5pdGlhbGlzZSB0aGUgY29ubmVjdGlvbnMgYXQgc3RhcnR1cC5cclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmJpbmQoXCJjb25uZWN0aW9uXCIsIGZ1bmN0aW9uIChjb25uSW5mbywgb3JpZ2luYWxFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluaXQoY29ubkluZm8uY29ubmVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICQoY29udGFpbmVyKS5maW5kKFwiLmFjdGl2aXR5XCIpLmVhY2goZnVuY3Rpb24gKHRoaXM6IEhUTUxFbGVtZW50KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGFjdGl2aXR5IGRyYWdnYWJsZS5cclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kcmFnZ2FibGUodGhpcywgeyBncmlkOiBbMjAsIDIwXSB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29uZmlndXJlIHRoZSBhY3Rpdml0eSBhcyB0YXJnZXQuXHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdGFuY2UubWFrZVRhcmdldCh0aGlzLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRyb3BPcHRpb25zOiB7IGhvdmVyQ2xhc3M6IFwiaG92ZXJcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IFwiVG9wXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZHBvaW50OlsgXCJEb3RcIiwgeyByYWRpdXM6IDggfSBdXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBjb25uZWN0IGEgZmV3IHVwXHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5jb25uZWN0KHsgdXVpZHM6IFtcIldpbmRvdzJCb3R0b21DZW50ZXJcIiwgXCJXaW5kb3czVG9wQ2VudGVyXCJdLCBlZGl0YWJsZTogdHJ1ZSB9KTtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLmNvbm5lY3QoeyB1dWlkczogW1wiV2luZG93MkxlZnRNaWRkbGVcIiwgXCJXaW5kb3c0TGVmdE1pZGRsZVwiXSwgZWRpdGFibGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5jb25uZWN0KHsgdXVpZHM6IFtcIldpbmRvdzRUb3BDZW50ZXJcIiwgXCJXaW5kb3c0UmlnaHRNaWRkbGVcIl0sIGVkaXRhYmxlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuY29ubmVjdCh7IHV1aWRzOiBbXCJXaW5kb3czUmlnaHRNaWRkbGVcIiwgXCJXaW5kb3cyUmlnaHRNaWRkbGVcIl0sIGVkaXRhYmxlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuY29ubmVjdCh7IHV1aWRzOiBbXCJXaW5kb3c0Qm90dG9tQ2VudGVyXCIsIFwiV2luZG93MVRvcENlbnRlclwiXSwgZWRpdGFibGU6IHRydWUgfSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5jb25uZWN0KHsgdXVpZHM6IFtcIldpbmRvdzNCb3R0b21DZW50ZXJcIiwgXCJXaW5kb3cxQm90dG9tQ2VudGVyXCJdLCBlZGl0YWJsZTogdHJ1ZSB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5iaW5kKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGNvbm4sIG9yaWdpbmFsRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kZWxldGVDb25uZWN0aW9uKGNvbm4pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuYmluZChcImNvbm5lY3Rpb25EcmFnXCIsIGZ1bmN0aW9uIChjb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uIFwiICsgY29ubmVjdGlvbi5pZCArIFwiIGlzIGJlaW5nIGRyYWdnZWQuIHN1c3BlbmRlZEVsZW1lbnQgaXMgXCIsIGNvbm5lY3Rpb24uc3VzcGVuZGVkRWxlbWVudCwgXCIgb2YgdHlwZSBcIiwgY29ubmVjdGlvbi5zdXNwZW5kZWRFbGVtZW50VHlwZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5iaW5kKFwiY29ubmVjdGlvbkRyYWdTdG9wXCIsIGZ1bmN0aW9uIChjb25uZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uIFwiICsgY29ubmVjdGlvbi5pZCArIFwiIHdhcyBkcmFnZ2VkXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuYmluZChcImNvbm5lY3Rpb25Nb3ZlZFwiLCBmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb25uZWN0aW9uIFwiICsgcGFyYW1zLmNvbm5lY3Rpb24uaWQgKyBcIiB3YXMgbW92ZWRcIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmpzUGx1bWJJbnN0YW5jZSA9IGluc3RhbmNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUganNQbHVtYkluc3RhbmNlOiBqc1BsdW1iSW5zdGFuY2U7XHJcbn1cclxuXHJcbiQuZm4ud29ya2Zsb3dFZGl0b3IgPSBmdW5jdGlvbiAodGhpczogSlF1ZXJ5KTogSlF1ZXJ5IHtcclxuICAgIGxldCB3b3JrZmxvd0VkaXRvciA9IG5ldyBXb3JrZmxvd0VkaXRvcih0aGlzWzBdKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG4gICAgJCgnLndvcmtmbG93LWVkaXRvci1jYW52YXMnKS53b3JrZmxvd0VkaXRvcigpO1xyXG59KTsiXX0=
