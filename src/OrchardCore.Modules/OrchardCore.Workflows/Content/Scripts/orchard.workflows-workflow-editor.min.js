var WorkflowEditor=function(){return function(t,o){var n=this;this.container=t,this.serialize=function(){for(var t=$(this.container).find(".activity"),o={activities:[],connections:[]},n=0;n<t.length;n++){var e=$(t[n]),i=e.data("activity-model"),a=e.position();o.activities.push({id:i.id,x:a.left,y:a.top})}var r=this.jsPlumbInstance.getConnections();for(n=0;n<r.length;n++){var c=r[n],s=c.endpoints[0].getParameters().outcome.name,l=$(c.source).data("activity-model"),d=$(c.target).data("activity-model");o.connections.push({sourceActivityId:l.id,destinationActivityId:d.id,sourceOutcomeName:s})}return JSON.stringify(o)},jsPlumb.ready(function(){var e=jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t}),i=function(t){return{endpoint:"Dot",anchor:"Continuous",paintStyle:{stroke:"#7AB02C",fill:"#7AB02C",radius:7,strokeWidth:1},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:"#999999",joinstyle:"round",outlineStroke:"white",outlineWidth:2},hoverPaintStyle:{fill:"#216477",stroke:"#216477"},connectorHoverStyle:{strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},dragOptions:{},overlays:[["Label",{location:[.5,1.5],cssClass:"endpointSourceLabel",visible:!0}]],parameters:{outcome:t}}};e.batch(function(){e.bind("connection",function(t,o){var n=t.connection,e=n.getParameters().outcome;n.getOverlay("label").setLabel(e.displayName)});for(var n=0,a=o.activities;n<a.length;n++){var r=a[n],c=$('<div class="activity" style="left:'+r.x+"px; top:"+r.y+'px;"></div>'),s=c[0];$(t).append(c),e.draggable(s,{grid:[20,20]}),e.makeTarget(s,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:8}]}),r.outcomes.length;for(var l=0,d=r.outcomes;l<d.length;l++){var u=d[l],v=i(u);e.addEndpoint(s,v)}$(s).data("activity-model",r)}e.bind("click",function(t,o){}),e.bind("connectionDrag",function(t){console.log("connection "+t.id+" is being dragged. suspendedElement is ",t.suspendedElement," of type ",t.suspendedElementType)}),e.bind("connectionDragStop",function(t){console.log("connection "+t.id+" was dragged")}),e.bind("connectionMoved",function(t){console.log("connection "+t.connection.id+" was moved")})}),n.jsPlumbInstance=e})}}();$.fn.workflowEditor=function(){return this.each(function(t,o){var n=$(o),e=n.data("workflow-definition");n.data("workflowEditor",new WorkflowEditor(o,e))}),this},$(document).ready(function(){var t=$(".workflow-editor-canvas").workflowEditor().data("workflowEditor");$("#workflowEditorForm").on("submit",function(o,n){var e=t.serialize();$("#workflowStateInput").val(e)})});
