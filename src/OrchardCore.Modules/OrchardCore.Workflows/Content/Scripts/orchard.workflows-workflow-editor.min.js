var WorkflowEditor=function(){return function(t,n){var o=this;this.container=t,this.serialize=function(){for(var t=$(this.container).find(".activity"),n={activities:[],transitions:[]},o=0;o<t.length;o++){var i=$(t[o]),e=i.data("activity-id"),r=i.position();n.activities.push({id:e,x:r.left,y:r.top})}var a=this.jsPlumbInstance.getConnections();for(o=0;o<a.length;o++){var c=a[o],s=c.endpoints[0].getParameters().outcome.name,d=$(c.source).data("activity-id"),l=$(c.target).data("activity-id");n.transitions.push({sourceActivityId:d,destinationActivityId:l,sourceOutcomeName:s})}return JSON.stringify(n)},jsPlumb.ready(function(){var i=jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,width:11,length:11}],["Label",{location:.5,id:"label",cssClass:"connection-label"}]],Container:t}),e=function(t,n){return{endpoint:"Dot",anchor:"Continuous",paintStyle:{stroke:"#7AB02C",fill:"#7AB02C",radius:7,strokeWidth:1},isSource:!0,connector:["Flowchart",{stub:[40,60],gap:0,cornerRadius:5,alwaysRespectStubs:!0}],connectorStyle:{strokeWidth:2,stroke:"#999999",joinstyle:"round",outlineStroke:"white",outlineWidth:2},hoverPaintStyle:{fill:"#216477",stroke:"#216477"},connectorHoverStyle:{strokeWidth:3,stroke:"#216477",outlineWidth:5,outlineStroke:"white"},dragOptions:{},overlays:[["Label",{location:[.5,1.5],cssClass:"endpointSourceLabel",visible:!0}]],uuid:t.id+"-"+n.name,parameters:{outcome:n}}};i.bind("connection",function(t,n){var o=t.connection,i=o.getParameters().outcome;o.getOverlay("label").setLabel(i.displayName)}),i.batch(function(){var o=n,r=o.id;$(t).find(".activity").each(function(t,n){var r=$(n).data("activity-id");i.draggable(n,{grid:[10,10]}),i.makeTarget(n,{dropOptions:{hoverClass:"hover"},anchor:"Continuous",endpoint:["Blank",{radius:8}]});for(var a=$.grep(o.activities,function(t){return t.id==r})[0],c=(a.outcomes.length,0),s=a.outcomes;c<s.length;c++){var d=s[c],l=e(a,d);i.addEndpoint(n,l)}});for(var a=0,c=o.transitions;a<c.length;a++){var s=c[a],d=s.sourceActivityId+"-"+s.sourceOutcomeName,l=i.getEndpoint(d),u="activity-"+r+"-"+s.destinationActivityId;i.connect({source:l,target:u})}i.bind("click",function(t,n){}),i.bind("connectionDrag",function(t){console.log("connection "+t.id+" is being dragged. suspendedElement is ",t.suspendedElement," of type ",t.suspendedElementType)}),i.bind("connectionDragStop",function(t){console.log("connection "+t.id+" was dragged")}),i.bind("connectionMoved",function(t){console.log("connection "+t.connection.id+" was moved")})}),o.jsPlumbInstance=i})}}();$.fn.workflowEditor=function(){return this.each(function(t,n){var o=$(n),i=o.data("workflow-definition");o.data("workflowEditor",new WorkflowEditor(n,i))}),this},$(document).ready(function(){var t=$(".workflow-editor-canvas").workflowEditor().data("workflowEditor");$("#workflowEditorForm").on("submit",function(n,o){var i=t.serialize();$("#workflowStateInput").val(i)})});
